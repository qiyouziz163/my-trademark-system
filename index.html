<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ä¼ä¼˜å’¨ Â· å•†æ ‡ç”³è¯·ä¸‹å•ç³»ç»Ÿ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, 'å¾®è½¯é›…é»‘', system-ui, -apple-system, sans-serif;
        }
        body {
            background: #f5f7fa;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 16px;
        }
        .app-container {
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 28px;
            box-shadow: 0 20px 40px rgba(0,20,60,0.08);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #002856 0%, #003d7c 100%);
            color: white;
            padding: 24px 22px 16px;
        }
        .header h1 {
            font-size: 1.9rem;
            font-weight: 500;
            margin: 0;
            letter-spacing: 0.5px;
            line-height: 1.2;
        }
        .header p {
            margin: 8px 0 0;
            opacity: 0.8;
            font-size: 0.95rem;
        }
        /* æ–°å¢é€‰é¡¹å¡å¯¼èˆª */
        .tab-bar {
            display: flex;
            background: white;
            padding: 0 24px;
            gap: 28px;
            border-bottom: 1px solid #e0e8f2;
        }
        .tab {
            padding: 14px 0 10px;
            cursor: pointer;
            color: #4a5f7a;
            font-weight: 600;
            font-size: 1rem;
            border-bottom: 3px solid transparent;
            transition: all 0.1s;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .tab.active {
            color: #003d7c;
            border-bottom-color: #003d7c;
        }
        .tab:hover {
            color: #002856;
        }
        /* åŸæœ‰ä¸‹å•åŒºåŸŸ (ä¸‰åˆ—) */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 1.2fr;
            gap: 20px;
            padding: 24px;
            background: #f9fafc;
        }
        /* æ–°æµç¨‹é¢æ¿å¸ƒå±€ (å•åˆ—å¡ç‰‡) */
        .flow-layout {
            padding: 24px;
            background: #f9fafc;
        }
        .card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.02);
            padding: 20px;
            border: 1px solid rgba(0,40,86,0.06);
        }
        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: #003d7c;
            display: flex;
            align-items: center;
            gap: 6px;
            border-bottom: 2px solid #eef2f6;
            padding-bottom: 10px;
        }
        /* æµç¨‹æ­¥éª¤æ ·å¼ */
        .flow-steps {
            display: flex;
            flex-direction: column;
        }
        .flow-step {
            display: flex;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px dashed #d9e2ef;
        }
        .flow-step:last-child {
            border-bottom: none;
        }
        .step-num {
            font-size: 1.9rem;
            min-width: 60px;
            font-weight: 500;
            color: #003d7c;
            line-height: 1.2;
        }
        .step-desc {
            flex: 1;
            font-size: 1rem;
            color: #1f3a5f;
            padding-top: 4px;
        }
        .step-desc strong {
            color: #b45309;
            background: #fff2e0;
            padding: 2px 8px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-left: 6px;
            white-space: nowrap;
        }
        .footnote {
            margin-top: 24px;
            background: #edf3fc;
            border-radius: 40px;
            padding: 14px 20px;
            color: #2f4b74;
            font-size: 0.9rem;
            border: 1px solid #c9d8ec;
        }
        .footnote i {
            color: #003d7c;
            font-style: normal;
            font-weight: 500;
        }
        /* åŸæœ‰å…¶ä»–æ ·å¼ä¿æŒä¸å˜ */
        .search-box {
            display: flex;
            gap: 8px;
            margin-bottom: 18px;
        }
        .search-box input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #d9e1ec;
            border-radius: 40px;
            font-size: 1rem;
            outline: none;
        }
        .search-box input:focus {
            border-color: #003d7c;
            box-shadow: 0 0 0 3px rgba(0,61,124,0.1);
        }
        .tree-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #eaeef4;
            border-radius: 20px;
            padding: 8px 4px;
            background: #ffffff;
        }
        .tree-ul {
            list-style: none;
            padding-left: 0;
        }
        .tree-ul ul {
            display: none;
            margin-left: 16px;
            padding-left: 8px;
            border-left: 1px dashed #ccc;
        }
        .tree-ul li.expanded > ul {
            display: block;
        }
        .folder-label {
            cursor: pointer;
            user-select: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 0;
            width: 100%;
        }
        .folder-label::before {
            content: "â–¶";
            font-size: 0.8rem;
            color: #003d7c;
            transition: transform 0.1s;
            display: inline-block;
            width: 16px;
        }
        li.expanded > .folder-label::before {
            content: "â–¼";
        }
        .cat-major {
            font-weight: 600;
            color: #1e2f4e;
            background: #f2f6fc;
            padding: 8px 16px;
            border-radius: 30px;
            margin: 12px 0 6px;
            font-size: 1rem;
        }
        .cat-group {
            font-weight: 500;
            color: #2a4b7c;
            padding: 6px 0 4px 12px;
            background: #f8faff;
            border-radius: 20px 0 0 20px;
            margin: 4px 0;
        }
        .subclass-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px 6px 20px;
            border-radius: 30px;
        }
        .subclass-item:hover {
            background: #edf3ff;
        }
        .subclass-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #003d7c;
            flex-shrink: 0;
        }
        .subclass-name {
            font-size: 0.95rem;
            word-break: break-word;
        }
        .selected-list {
            min-height: 150px;
            max-height: 250px;
            overflow-y: auto;
            background: #f8fafd;
            border-radius: 18px;
            padding: 12px;
            border: 1px solid #dee7f0;
            margin: 15px 0;
        }
        .selected-list ul {
            padding-left: 20px;
        }
        .selected-list li {
            margin: 5px 0;
            color: #1f3a5f;
        }
        .badge {
            background: #d3e5ff;
            color: #003d7c;
            border-radius: 30px;
            padding: 4px 12px;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
        }
        .btn-clear {
            background: white;
            border: 1px solid #ccdae9;
            border-radius: 40px;
            padding: 8px 18px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: 0.1s;
        }
        .btn-clear:hover {
            background: #f0f4fe;
        }
        .form-row {
            margin-bottom: 18px;
        }
        .form-row label {
            display: block;
            font-weight: 500;
            color: #1f3a5f;
            margin-bottom: 6px;
            font-size: 0.95rem;
        }
        .form-row input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d0ddee;
            border-radius: 40px;
            font-size: 1rem;
            outline: none;
        }
        .form-row input:focus {
            border-color: #003d7c;
            box-shadow: 0 0 0 3px rgba(0,61,124,0.1);
        }
        .upload-area {
            border: 2px dashed #b6cae0;
            border-radius: 24px;
            padding: 24px;
            text-align: center;
            background: #fcfdff;
            cursor: pointer;
            margin: 10px 0;
        }
        .upload-area:hover {
            background: #f2f8ff;
            border-color: #003d7c;
        }
        .preview-box {
            margin-top: 12px;
            display: flex;
            justify-content: center;
            background: #f4f8ff;
            border-radius: 18px;
            padding: 16px;
            min-height: 120px;
            align-items: center;
        }
        .preview-box img {
            max-width: 100%;
            max-height: 160px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .scheme-panel {
            background: #f6faff;
            border-radius: 20px;
            padding: 12px;
        }
        .scheme-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 14px;
            background: white;
            border-radius: 40px;
            margin-bottom: 8px;
            border: 1px solid #e0eaf7;
            cursor: pointer;
            transition: border 0.1s;
        }
        .scheme-option.selected {
            border: 2px solid #003d7c;
            background: #eaf3ff;
        }
        .scheme-option input[type="radio"] {
            accent-color: #003d7c;
            width: 18px;
            height: 18px;
            flex-shrink: 0;
            margin-top: 2px;
        }
        .scheme-option .scheme-content {
            flex: 1;
            min-width: 0;
        }
        .scheme-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 4px 8px;
        }
        .scheme-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: #00305c;
        }
        .scheme-desc {
            font-size: 0.85rem;
            color: #2f4b74;
            background: #edf2fa;
            padding: 2px 10px;
            border-radius: 30px;
            white-space: nowrap;
        }
        .scheme-features {
            font-size: 0.75rem;
            color: #3e5a7a;
            margin-top: 6px;
            line-height: 1.45;
            display: flex;
            flex-wrap: wrap;
            gap: 6px 12px;
            border-top: 1px dashed #d3dff0;
            padding-top: 6px;
        }
        .scheme-features span {
            background: #eef3fc;
            padding: 2px 8px;
            border-radius: 30px;
            white-space: nowrap;
        }
        .legal-notice {
            background: #fff8e7;
            border-left: 4px solid #f0b342;
            border-radius: 16px;
            padding: 12px 14px;
            margin: 18px 0 16px;
            font-size: 0.8rem;
            color: #4f3e1f;
            line-height: 1.5;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        .legal-notice strong {
            color: #b45309;
        }
        .invoice-check {
            display: flex;
            align-items: center;
            gap: 12px;
            background: white;
            padding: 14px 18px;
            border-radius: 40px;
            border: 1px solid #dae3f0;
            margin: 18px 0;
        }
        .invoice-check input {
            width: 20px;
            height: 20px;
            accent-color: #003d7c;
        }
        .invoice-check label {
            font-weight: 500;
            font-size: 1rem;
        }
        .fee-box {
            background: #f2f6fd;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            white-space: pre-wrap;
            font-size: 0.9rem;
            line-height: 1.6;
            max-height: 350px;
            overflow-y: auto;
            border: 1px solid #c9d8ec;
        }
        .button-group {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .btn-primary {
            background: #003d7c;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 8px 16px rgba(0,61,124,0.2);
            transition: 0.1s;
            flex: 1 1 auto;
        }
        .btn-primary:hover {
            background: #002856;
            transform: scale(0.98);
        }
        .btn-secondary {
            background: white;
            border: 1px solid #b6cae0;
            padding: 14px 24px;
            border-radius: 40px;
            font-weight: 500;
            cursor: pointer;
            flex: 1 1 auto;
        }
        .btn-secondary:hover {
            background: #f2f8ff;
        }
        .footer-info {
            color: #6f7d95;
            padding: 14px 24px;
            border-top: 1px solid #e0e8f2;
            font-size: 0.85rem;
            text-align: right;
        }
        @media (max-width: 900px) {
            body { padding: 10px; }
            .main-layout {
                grid-template-columns: 1fr;
                gap: 16px;
                padding: 16px;
            }
            .flow-layout { padding: 16px; }
            .tree-container { max-height: 400px; }
            .selected-list { max-height: 200px; }
            .fee-box { max-height: 300px; }
            .scheme-desc { white-space: normal; }
            .step-num { min-width: 50px; font-size: 1.6rem; }
        }
        @media (max-width: 480px) {
            .header h1 { font-size: 1.5rem; }
            .card { padding: 16px; }
            .subclass-item { padding-left: 10px; }
            .tab-bar { gap: 16px; padding: 0 16px; }
            .tab { font-size: 0.9rem; padding: 12px 0 8px; }
        }
    </style>
</head>
<body>
<div class="app-container">
    <div class="header">
        <h1>ğŸ“‹ ä¼ä¼˜å’¨ Â· å•†æ ‡ç”³è¯·æ³¨å†Œä¸‹å•</h1>
        <p>é€‰è¦æ³¨å†Œçš„å°ç±»-å¡«å†™ç”³è¯·äººä¿¡æ¯-é€‰æœåŠ¡æ–¹æ¡ˆ-ä¸‹å•</p>
        <p>å¦‚éœ€å¸®åŠ©ï¼Œè”ç³»é™ˆå·¥ 13128311370</p>
    </div>

    <!-- æ–°å¢çš„é€‰é¡¹å¡å¯¼èˆª -->
    <div class="tab-bar">
        <div class="tab active" id="tabOrder">ğŸ“‹ å•†æ ‡ä¸‹å•</div>
        <div class="tab" id="tabFlow">ğŸ“Š ä»˜æ¬¾åæµç¨‹</div>
    </div>

    <!-- åŸä¸‹å•é¢æ¿ (ä¸‰åˆ—) é»˜è®¤æ˜¾ç¤º -->
    <div id="orderPanel" class="main-layout">
        <!-- å·¦ä¾§ï¼šåˆ†ç±»æ ‘ + æœç´¢ (å†…å®¹å®Œå…¨ä¿ç•™) -->
        <div class="card">
            <div class="card-title">ğŸ” ä¸€ã€é€‰æ‹©å•†æ ‡åˆ†ç±»</div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="è¾“å…¥å…³é”®è¯æœç´¢...">
                <span class="badge" id="searchCount">0 é¡¹</span>
            </div>
            <div class="tree-container" id="treeContainer">
                <ul class="tree-ul" id="categoryTree"></ul>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px;">
                <button class="btn-clear" id="clearSelectedBtn">ğŸ§¹ æ¸…ç©ºå·²é€‰</button>
                <span class="badge" id="selectedCountBadge">å·²é€‰ 0 ä¸ªå°ç±»</span>
            </div>
        </div>

        <!-- ä¸­é—´ï¼šå·²é€‰å°ç±» & ç”³è¯·äººä¿¡æ¯ & å›¾æ · -->
        <div class="card">
            <div class="card-title">ğŸ“‹ äºŒã€å·²é€‰å°ç±» & ç”³è¯·äºº</div>
            <div><strong>ğŸ“Œ å·²é€‰å°ç±»åˆ—è¡¨</strong></div>
            <div class="selected-list" id="selectedListContainer">
                <ul id="selectedListUl" style="padding-left: 16px;"></ul>
            </div>

            <div class="form-row">
                <label>ç”³è¯·äººå…¨ç§° <span style="color:#a00;">*</span></label>
                <input type="text" id="applicantName" placeholder="å¦‚ï¼šä¼ä¼˜å’¨æœ‰é™å…¬å¸">
            </div>
            <div class="form-row">
                <label>å•†æ ‡åç§° <span style="color:#a00;">*</span></label>
                <input type="text" id="trademarkName" placeholder="å¦‚ï¼šä¼ä¼˜å’¨">
            </div>
            <div class="form-row">
                <label>è”ç³»ç”µè¯</label>
                <input type="text" id="contactPhone" placeholder="æ‰‹æœº/å›ºè¯">
            </div>
            <div class="form-row">
                <label>è”ç³»äººå§“å</label>
                <input type="text" id="contactPerson" placeholder="å§“å">
            </div>

            <div><strong>ğŸ–¼ï¸ å•†æ ‡å›¾æ ·</strong></div>
            <div class="upload-area" id="uploadArea">
                ğŸ“ ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡ (PNG/JPGç­‰)
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
            </div>
            <div class="preview-box" id="imagePreview">
                <span style="color:#99aec6;">æš‚æ— é¢„è§ˆ</span>
            </div>
        </div>

        <!-- å³ä¾§ï¼šæœåŠ¡æ–¹æ¡ˆ & è´¹ç”¨ & æ“ä½œ (å«ä¸€é”®ç”ŸæˆåˆåŒ) -->
        <div class="card">
            <div class="card-title">ğŸ¯ ä¸‰ã€æœåŠ¡æ–¹æ¡ˆ & è´¹ç”¨</div>
            <div class="scheme-panel">
                <div class="scheme-option" id="schemeA">
                    <input type="radio" name="scheme" value="A" id="radioA" checked> 
                    <div class="scheme-content">
                        <div class="scheme-header">
                            <span class="scheme-name">Aæ–¹æ¡ˆÂ·æµç¨‹è·Ÿè¿›</span>
                            <span class="scheme-desc">380å…ƒ/å¤§ç±»(å«10å°ç±»)ï¼Œè¶…å‡º38/å°ç±»</span>
                        </div>
                        <div class="scheme-features">
                            <span>ğŸ“ ææ–™å½¢å¼å®¡æ ¸</span>
                            <span>ğŸ“¬ å®˜æ–¹æ–‡ä»¶ä»£æ”¶ä»£å‘</span>
                            <span>â° å…³é”®èŠ‚ç‚¹äººå·¥æé†’</span>
                            <span>ğŸ”„ å…¨æµç¨‹è¿›åº¦åŒæ­¥</span>
                        </div>
                    </div>
                </div>
                <div class="scheme-option" id="schemeB">
                    <input type="radio" name="scheme" value="B" id="radioB"> 
                    <div class="scheme-content">
                        <div class="scheme-header">
                            <span class="scheme-name">Bæ–¹æ¡ˆÂ·ä¸“ä¸šè¾…å¯¼</span>
                            <span class="scheme-desc">580å…ƒ/å¤§ç±»ï¼Œè¶…å‡º58/å°ç±»ï¼Œå¤§ç±»ï¼6ç«‹å‡15%</span>
                        </div>
                        <div class="scheme-features">
                            <span>ğŸ›¡ï¸ æ³¨å†Œå‰é£é™©è¯„ä¼°</span>
                            <span>ğŸ“Œ ç±»åˆ«è§„åˆ’å»ºè®®</span>
                            <span>ğŸ“ ç”³è¯·ææ–™ä¼˜åŒ–</span>
                            <span>ğŸ“ ä¸“ä¸šè§£è¯»ä¸æŒ‡å¯¼</span>
                        </div>
                    </div>
                </div>
                <div class="scheme-option" id="schemeC">
                    <input type="radio" name="scheme" value="C" id="radioC"> 
                    <div class="scheme-content">
                        <div class="scheme-header">
                            <span class="scheme-name">Cæ–¹æ¡ˆÂ·åç½®ä»˜è´¹</span>
                            <span class="scheme-desc">1100å…ƒ/å¤§ç±»ï¼Œè¶…å‡º110/å°ç±»ï¼Œé¦–ä»˜300å®˜è´¹</span>
                        </div>
                        <div class="scheme-features">
                            <span>ğŸ’° å¯åŠ¨æˆæœ¬æ›´ä½(ä»…ä»˜å®˜è´¹)</span>
                            <span>âœ… ä¸‹è¯åå†ä»˜æœåŠ¡è´¹</span>
                            <span>â³ åç½®ä»˜è´¹æ›´ä»å®¹</span>
                        </div>
                    </div>
                </div>

                <div class="invoice-check">
                    <input type="checkbox" id="invoiceCheckbox">
                    <label for="invoiceCheckbox" id="invoiceLabel">ğŸ“„ å¼€ä¸“ç¥¨ï¼ˆåŠ æ”¶5%ï¼‰</label>
                </div>

                <div class="legal-notice">
                    <strong>ğŸ“¢ ç‰¹åˆ«å£°æ˜ï¼š</strong> å•†æ ‡å®¡æŸ¥æƒå½’å±å›½å®¶çŸ¥è¯†äº§æƒå±€ï¼Œå®¡æŸ¥ç»“æœå­˜åœ¨ä¸»è§‚å› ç´ ï¼Œä»»ä½•ä»£ç†æœºæ„å‡ä¸å¾—æ‰¿è¯ºâ€œåŒ…è¿‡â€ï¼è‹¥è¢«é©³å›ã€è¢«å¼‚è®®ï¼Œå·²æ”¶å–è´¹ç”¨ä¸å¯é€€ï¼å¦‚æ‚¨æ‹…å¿ƒå•†æ ‡æ³¨å†Œè¯ä¸‹ä¸æ¥ï¼Œ<strong>å¯é€‰Cæ–¹æ¡ˆï¼šå¾…ä¸‹è¯åå†ä»˜æœåŠ¡è´¹ã€‚</strong>
                </div>
            </div>

            <div class="fee-box" id="feeDisplay">
                âš ï¸ è¯·å…ˆé€‰æ‹©å°ç±»
            </div>

            <div class="button-group">
                <button class="btn-secondary" id="previewOrderBtn">ğŸ“‹ é¢„è§ˆ</button>
                <button class="btn-secondary" id="generateContractBtn">ğŸ“„ ä¸€é”®ç”ŸæˆåˆåŒ</button>
                <button class="btn-primary" id="exportWordBtn">ğŸ“ å¯¼å‡ºWordè®¢å•</button>
            </div>
            <p style="font-size:0.75rem; color:#7f8fa4; margin-top: 8px;">*å¯¼å‡ºæ—¶æµè§ˆå™¨ä¼šæç¤ºä¸‹è½½ï¼Œæ–‡ä»¶å¯ä¿å­˜è‡³æ‰‹æœºã€‚</p>
        </div>
    </div>

    <!-- æ–°å¢æµç¨‹é¢æ¿ (é»˜è®¤éšè—) -->
    <div id="flowPanel" class="flow-layout" style="display: none;">
        <div class="card">
            <div class="card-title">ğŸ“Š ä»˜æ¬¾åæœåŠ¡æµç¨‹å›¾ï¼ˆå‚è€ƒæ—¶é—´ï¼‰</div>
            <div class="flow-steps">
                <div class="flow-step"><span class="step-num">1ï¸âƒ£</span><span class="step-desc">ç­¾è®¢åˆåŒã€ä»˜æ¬¾åï¼Œå¼€å§‹æœåŠ¡æµç¨‹ â†“â†“â†“</span></div>
                <div class="flow-step"><span class="step-num">2ï¸âƒ£</span><span class="step-desc">æ ¹æ®æ‚¨æ‰€é€‰æ–¹æ¡ˆè¿›è¡Œå¯¹åº”æœåŠ¡æµç¨‹</span></div>
                <div class="flow-step"><span class="step-num">3ï¸âƒ£</span><span class="step-desc">è·Ÿæ‚¨å†æ¬¡ç¡®è®¤å•†æ ‡ç”³è¯·ä¿¡æ¯è¡¨åï¼Œæäº¤å•†æ ‡å±€</span></div>
                <div class="flow-step"><span class="step-num">4ï¸âƒ£</span><span class="step-desc">æäº¤å•†æ ‡å±€åï¼Œæœ€å¿«å½“å¤©æœ‰å›æ‰§ä¹¦ç»™æ‚¨</span></div>
                <div class="flow-step"><span class="step-num">5ï¸âƒ£</span><span class="step-desc">å¤§æ¦‚1ä¸ªæœˆï¼Œæœ‰å—ç†é€šçŸ¥ä¹¦ç»™æ‚¨ â€”â€” å¦‚é‡è¡¥æ­£ï¼š<strong>è¡¥æ­£ï¼ˆå…è´¹ï¼‰</strong></span></div>
                <div class="flow-step"><span class="step-num">6ï¸âƒ£</span><span class="step-desc">å¤§æ¦‚2-3ä¸ªæœˆï¼Œæœ‰å®¡æŸ¥æ„è§ç»™æ‚¨ï¼ˆé©³å›æˆ–åˆæ­¥å®¡å®šå…¬å‘Šï¼‰</span></div>
                <div class="flow-step"><span class="step-num">7ï¸âƒ£</span><span class="step-desc">å›ºå®š3ä¸ªæœˆçš„å…¬å‘ŠæœŸ</span></div>
                <div class="flow-step"><span class="step-num">8ï¸âƒ£</span><span class="step-desc">è‹¥è¢«å•†æ ‡å±€é©³å›ï¼šå¦‚æ‚¨æƒ³åšé©³å›å¤å®¡ï¼Œæ‚¨éœ€å¦ä»˜è´¹ã€‚å¤å®¡å‘¨æœŸçº¦1å¹´ã€‚</span></div>
                <div class="flow-step"><span class="step-num">9ï¸âƒ£</span><span class="step-desc">è‹¥è¢«å…¬ä¼—æå‡ºå¼‚è®®ï¼šå¦‚æ‚¨æƒ³åšå¼‚è®®ç­”è¾©ï¼Œæ‚¨éœ€å¦ä»˜è´¹ã€‚ç­”è¾©å‘¨æœŸçº¦1å¹´ã€‚</span></div>
                <div class="flow-step"><span class="step-num">ğŸ”Ÿ</span><span class="step-desc">å¤§æ¦‚1ä¸ªæœˆï¼Œæœ‰å•†æ ‡æ³¨å†Œè¯ç»™æ‚¨ <strong>ï¼ˆå¦‚æœæ‚¨é‡‡ç”¨Cæ–¹æ¡ˆï¼Œæ­¤æ—¶æ‚¨éœ€è¦ç»“æ¸…å°¾æ¬¾ï¼‰</strong></span></div>
            </div>
            <div class="footnote">
                <i>ğŸ“Œ ä»¥ä¸Šæ—¶é—´å‘¨æœŸä¸ºç›®å‰è¡Œæƒ…æ”¿ç­–çš„å¤§æ¦‚ä¼°ç®—æ—¶é—´ï¼Œå…·ä½“æ—¶é—´å‘¨æœŸä»¥å®é™…å®¡æŸ¥æƒ…å†µä¸ºå‡†ã€‚</i>
            </div>
            <p style="margin-top: 20px; color: #6f7d95; font-size:0.9rem; text-align:right;">â€”â€” ä¼ä¼˜å’¨ Â· é€æ˜æµç¨‹ â€”â€”</p>
        </div>
    </div>

    <div class="footer-info">
        å¦‚éœ€å¸®åŠ©ï¼Œè”ç³»é™ˆå·¥ 13128311370
    </div>
</div>

<script>
    (function() {
        // ---------- åŸæœ‰å…¨å±€å˜é‡å’Œå‡½æ•° (ä¿æŒä¸å˜) ----------
        let rawData = [];
        let selectedSubclasses = {};          // å¤§ç±» -> å°ç±»åç§°æ•°ç»„
        let trademarkImageData = null;         // base64
        let imageFileName = '';

        const schemeParams = {
            A: { base: 380, extra: 38, name: 'æµç¨‹è·Ÿè¿›' },
            B: { base: 580, extra: 58, name: 'ä¸“ä¸šè¾…å¯¼' },
            C: { base: 1100, extra: 110, name: 'åç½®ä»˜è´¹' }
        };

        function cleanInput(str) {
            return str.replace(/\s+/g, '');
        }

        function getSelectedStats() {
            let majorCount = 0, totalSubCount = 0;
            for (let major in selectedSubclasses) {
                if (selectedSubclasses[major].length > 0) {
                    majorCount++;
                    totalSubCount += selectedSubclasses[major].length;
                }
            }
            return { majorCount, totalSubCount };
        }

        function updateSchemeSelection() {
            const checkedRadio = document.querySelector('input[name="scheme"]:checked');
            document.querySelectorAll('.scheme-option').forEach(opt => opt.classList.remove('selected'));
            if (checkedRadio) {
                const parent = checkedRadio.closest('.scheme-option');
                if (parent) parent.classList.add('selected');
            }
        }

        function computeFeeDetails() {
            const scheme = document.querySelector('input[name="scheme"]:checked')?.value || 'A';
            const params = schemeParams[scheme];
            const withInvoice = document.getElementById('invoiceCheckbox').checked;

            let totalOriginal = 0;
            const majorDetails = {};
            for (let major in selectedSubclasses) {
                let subList = selectedSubclasses[major];
                if (subList.length === 0) continue;
                let count = subList.length;
                let cost = (count <= 10) ? params.base : (params.base + (count - 10) * params.extra);
                majorDetails[major] = { count, cost };
                totalOriginal += cost;
            }

            const majorCount = Object.keys(selectedSubclasses).length;
            let finalTotal = totalOriginal;
            let discountNote = '';
            let tailDiscount = 1.0;
            if (scheme === 'B' && majorCount > 6) {
                finalTotal = totalOriginal * 0.85;
                discountNote = 'Bæ–¹æ¡ˆå¤§å®¢æˆ·ä¼˜æƒ : æ€»é‡‘é¢ç«‹å‡15%';
            }
            let invoiceAmount = withInvoice ? finalTotal * 0.05 : 0;
            let totalWithInvoice = finalTotal + invoiceAmount;

            let tailPercent = 800/1100; 
            if (scheme === 'C' && majorCount > 6) {
                tailPercent *= 0.85;
                discountNote = 'Cæ–¹æ¡ˆå¤§å®¢æˆ·ä¼˜æƒ : å°¾æ¬¾å‡å…15%';
            }

            return {
                scheme,
                params,
                withInvoice,
                majorDetails,
                majorCount,
                totalOriginal,
                finalTotal,
                invoiceAmount,
                totalWithInvoice,
                tailPercent,
                discountNote
            };
        }

        function computeFeeText() {
            const d = computeFeeDetails();
            if (Object.keys(selectedSubclasses).length === 0) return 'âš ï¸ å°šæœªé€‰æ‹©ä»»ä½•å°ç±»';

            let lines = [];
            lines.push(`=== æœåŠ¡æ–¹æ¡ˆ: ${d.scheme}æ–¹æ¡ˆÂ·${d.params.name} ===`);
            lines.push(`ğŸ’° åŸºç¡€ä»·æ ¼ï¼šæ¯å¤§ç±»${d.params.base}å…ƒï¼ˆå«10å°ç±»ï¼‰ï¼Œè¶…å‡ºéƒ¨åˆ†${d.params.extra}å…ƒ/å°ç±»ã€‚`);
            if (d.discountNote) lines.push(`ğŸ ${d.discountNote}`);
            if (d.scheme === 'C') lines.push('ğŸ Cæ–¹æ¡ˆå¤§å®¢æˆ·ä¼˜æƒ ï¼šå¤§ç±»ï¼6ä¸ªï¼Œå°¾æ¬¾å‡å…15%');
            lines.push('');

            lines.push('=== ğŸ’° è´¹ç”¨æ˜ç»† ===');
            for (let major in d.majorDetails) {
                let cost = d.majorDetails[major].cost;
                lines.push(`ğŸ“Œ ${major}å¤§ç±»ï¼ˆ${d.majorDetails[major].count}ä¸ªå°ç±»ï¼‰ = ${cost}å…ƒ`);
            }
            lines.push(`ğŸ“Š å°è®¡ï¼ˆåŸä»·ï¼‰: ${d.totalOriginal.toFixed(2)}å…ƒ`);
            if (d.scheme === 'B' && d.majorCount > 6) {
                lines.push(`ğŸ“Š å°è®¡ï¼ˆä¼˜æƒ åï¼‰: ${d.finalTotal.toFixed(2)}å…ƒ`);
            }
            if (d.withInvoice) {
                lines.push(`ğŸ§¾ ä¸“ç¥¨è´¹ç”¨ï¼ˆåŠ æ”¶5%ï¼‰: ${d.invoiceAmount.toFixed(2)}å…ƒ`);
                lines.push(`ğŸ’ æ€»åˆè®¡ï¼ˆå«ä¸“ç¥¨ï¼‰: ${d.totalWithInvoice.toFixed(2)}å…ƒ`);
            } else {
                lines.push(`ğŸ§¾ ä¸“ç¥¨è´¹ç”¨: 0å…ƒï¼ˆæœªé€‰æ‹©ï¼‰`);
                lines.push(`ğŸ’ æ€»åˆè®¡: ${d.finalTotal.toFixed(2)}å…ƒ`);
            }
            lines.push('');

            if (d.scheme === 'A' || d.scheme === 'B') {
                let payAmount = d.withInvoice ? d.totalWithInvoice : d.finalTotal;
                lines.push(`ã€${d.scheme}æ–¹æ¡ˆÂ·ä»˜æ¬¾è®¡åˆ’ã€‘`);
                lines.push(`ğŸ“… ç­¾åˆåŒåä¸€æ¬¡æ€§ä»˜æ¸…: ${payAmount.toFixed(2)}å…ƒ`);
            } else if (d.scheme === 'C') {
                lines.push('ã€Cæ–¹æ¡ˆÂ·åç½®ä»˜è´¹è®¡åˆ’ã€‘');
                let baseForFirst = d.withInvoice ? d.totalWithInvoice : d.finalTotal;
                let firstPayment = baseForFirst * (300/1100);
                lines.push(`ğŸ”¹ é¦–ä»˜æ¬¾ï¼ˆç­¾åˆåŒåï¼‰: ${baseForFirst.toFixed(2)}Ã—27.27% = ${firstPayment.toFixed(2)}å…ƒ`);
                if (d.majorCount > 6) lines.push('ğŸ ã€Cæ–¹æ¡ˆå°¾æ¬¾å‡å…15%ã€‘');
                lines.push('ğŸ”¹ å°¾æ¬¾æ”¯ä»˜ï¼ˆæ¯å¤§ç±»ä¸‹å‘æ³¨å†Œè¯åï¼‰:');
                let idx = 1;
                for (let major in d.majorDetails) {
                    let cost = d.majorDetails[major].cost;
                    let withInvoiceCost = d.withInvoice ? cost * 1.05 : cost;
                    let tail = withInvoiceCost * d.tailPercent;
                    lines.push(`   ${idx}.ç¬¬${major}å¤§ç±»å°¾æ¬¾ï¼š${withInvoiceCost.toFixed(2)}Ã—${(d.tailPercent*100).toFixed(2)}% = ${tail.toFixed(2)}å…ƒ`);
                    idx++;
                }
            }
            lines.push('');
            lines.push('=== ğŸ’³ ä»˜æ¬¾ä¿¡æ¯ ===');
            lines.push('è´¦æˆ·åç§°ï¼šä¼ä¼˜å’¨ï¼ˆå¹¿å·ï¼‰å’¨è¯¢æœ‰é™å…¬å¸');
            lines.push('è´¦æˆ·å·ç ï¼š4405 0158 0107 0000 4275');
            lines.push('å¼€æˆ·é“¶è¡Œï¼šä¸­å›½å»ºè®¾é“¶è¡Œè‚¡ä»½æœ‰é™å…¬å¸å¹¿å·èŠ±åŸæ”¯è¡Œ');
            lines.push('ã€ğŸ“Œ é‡è¦æç¤ºã€‘1. ä»˜æ¬¾æ°´å•å‘ç»™é™ˆå·¥ï¼›2. å¯åŠ¨æœåŠ¡åä¸æ”¯æŒé€€æ¬¾');
            return lines.join('\n');
        }

        function refreshUI() {
            updateSchemeSelection();

            const ul = document.getElementById('selectedListUl');
            ul.innerHTML = '';
            for (let major in selectedSubclasses) {
                if (selectedSubclasses[major].length === 0) continue;
                let li = document.createElement('li');
                li.innerHTML = `<strong>ã€${escapeHtml(major)}ã€‘</strong>`;
                ul.appendChild(li);
                let subUl = document.createElement('ul');
                selectedSubclasses[major].forEach(sub => {
                    let subLi = document.createElement('li');
                    subLi.textContent = sub;
                    subUl.appendChild(subLi);
                });
                ul.appendChild(subUl);
            }
            if (ul.children.length === 0) {
                ul.innerHTML = '<span style="color:#aaa;">æš‚æ— å·²é€‰å°ç±»</span>';
            }

            let stats = getSelectedStats();
            document.getElementById('selectedCountBadge').innerText = `å·²é€‰ ${stats.totalSubCount} ä¸ªå°ç±»`;
            document.getElementById('feeDisplay').innerText = computeFeeText();
            syncCheckboxesFromSelected();
        }

        function syncCheckboxesFromSelected() {
            const checkboxes = document.querySelectorAll('.subclass-checkbox');
            checkboxes.forEach(cb => {
                const major = cb.dataset.major;
                const sub = cb.dataset.sub;
                cb.checked = !!(selectedSubclasses[major] && selectedSubclasses[major].includes(sub));
            });
        }

        function handleCheckboxChange(e) {
            const cb = e.target;
            const major = cb.dataset.major;
            const sub = cb.dataset.sub;
            if (!major || !sub) return;
            if (cb.checked) {
                if (!selectedSubclasses[major]) selectedSubclasses[major] = [];
                if (!selectedSubclasses[major].includes(sub)) {
                    selectedSubclasses[major].push(sub);
                }
            } else {
                if (selectedSubclasses[major]) {
                    const idx = selectedSubclasses[major].indexOf(sub);
                    if (idx > -1) selectedSubclasses[major].splice(idx, 1);
                    if (selectedSubclasses[major].length === 0) delete selectedSubclasses[major];
                }
            }
            refreshUI();
        }

        function escapeHtml(unsafe) {
            return unsafe.replace(/[&<>"]/g, function(m) {
                if(m === '&') return '&amp;'; if(m === '<') return '&lt;'; if(m === '>') return '&gt;'; if(m === '"') return '&quot;';
                return m;
            });
        }
        function escapeAttr(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
        }

        function getTotalSubCount() {
            let c = 0;
            rawData.forEach(m => (m.children || []).forEach(g => (g.children || []).forEach(() => c++)));
            return c;
        }

        function renderTree(filterText = '') {
            const treeElem = document.getElementById('categoryTree');
            treeElem.innerHTML = '';
            if (!rawData || rawData.length === 0) {
                treeElem.innerHTML = '<li style="padding:20px; color:red;">âš ï¸ æœªåŠ è½½åˆ†ç±»æ•°æ®</li>';
                return;
            }

            let matchCount = 0;
            const lowerFilter = filterText.toLowerCase().trim();
            const hasFilter = lowerFilter !== '';

            rawData.forEach(majorNode => {
                const majorName = majorNode.å¤§ç±» || majorNode.name || '';
                let majorHasMatch = false;
                let groupsHTML = '';

                (majorNode.children || []).forEach(groupNode => {
                    const groupName = groupNode.name || groupNode.ç±»ä¼¼ç¾¤ç»„ || '';
                    const groupNumber = groupNode.ç±»ä¼¼ç¾¤ç»„ || '';
                    const groupText = `${groupNumber} ${groupName}`.toLowerCase();
                    let groupHasMatch = false;
                    let subItemsHTML = '';

                    (groupNode.children || []).forEach(subNode => {
                        const subName = subNode.å°ç±» || subNode.name || '';
                        const subText = subName.toLowerCase();
                        const match = !hasFilter || 
                                      majorName.toLowerCase().includes(lowerFilter) ||
                                      groupText.includes(lowerFilter) ||
                                      subText.includes(lowerFilter);
                        if (match || !hasFilter) {
                            groupHasMatch = true;
                            majorHasMatch = true;
                            matchCount++;
                            const checked = (selectedSubclasses[majorName] && selectedSubclasses[majorName].includes(subName)) ? 'checked' : '';
                            subItemsHTML += `<li class="subclass-item">
                                <input type="checkbox" class="subclass-checkbox" data-major="${escapeAttr(majorName)}" data-sub="${escapeAttr(subName)}" ${checked}>
                                <span class="subclass-name">${escapeHtml(subName)}</span>
                            </li>`;
                        }
                    });

                    if (groupHasMatch || !hasFilter) {
                        let groupLiClass = 'tree-li group-li';
                        if (hasFilter && groupHasMatch) groupLiClass += ' expanded';
                        groupsHTML += `<li class="${groupLiClass}">
                            <div class="folder-label cat-group" data-group="${escapeAttr(groupNumber)}">ğŸ“ ${escapeHtml(groupNumber)} - ${escapeHtml(groupName)}</div>
                            <ul class="group-subs">${subItemsHTML}</ul>
                        </li>`;
                    }
                });

                if (majorHasMatch || !hasFilter) {
                    let majorLiClass = 'tree-li major-li';
                    if (hasFilter && majorHasMatch) majorLiClass += ' expanded';
                    const majorLi = document.createElement('li');
                    majorLi.className = majorLiClass;
                    majorLi.innerHTML = `
                        <div class="folder-label cat-major" data-major="${escapeAttr(majorName)}">ğŸ“Œ å¤§ç±» ${escapeHtml(majorName)}</div>
                        <ul class="major-groups">${groupsHTML}</ul>
                    `;
                    treeElem.appendChild(majorLi);
                }
            });

            document.getElementById('searchCount').innerText = hasFilter ? `ğŸ” åŒ¹é… ${matchCount} é¡¹` : `å…± ${getTotalSubCount()} å°ç±»`;

            document.querySelectorAll('.subclass-checkbox').forEach(cb => {
                cb.removeEventListener('change', handleCheckboxChange);
                cb.addEventListener('change', handleCheckboxChange);
            });
            syncCheckboxesFromSelected();
            attachFolderListeners();
        }

        function attachFolderListeners() {
            document.querySelectorAll('.major-li > .folder-label').forEach(label => {
                label.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const li = this.parentElement;
                    li.classList.toggle('expanded');
                });
            });
            document.querySelectorAll('.group-li > .folder-label').forEach(label => {
                label.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const li = this.parentElement;
                    li.classList.toggle('expanded');
                });
            });
        }

        async function loadJSON() {
            try {
                const response = await fetch('å°¼æ–¯åˆ†ç±»è¡¨_æ ‘çŠ¶ç»“æ„.json');
                if (!response.ok) throw new Error('æ— æ³•åŠ è½½JSON (404)');
                rawData = await response.json();
                renderTree();
                refreshUI();
            } catch (e) {
                alert('åŠ è½½å°¼æ–¯åˆ†ç±»JSONå¤±è´¥ï¼Œè¯·å°† "å°¼æ–¯åˆ†ç±»è¡¨_æ ‘çŠ¶ç»“æ„.json" æ”¾åœ¨åŒç›®å½•ä¸‹ã€‚\né”™è¯¯ï¼š' + e.message);
            }
        }

        // æ¸…ç©º
        document.getElementById('clearSelectedBtn').addEventListener('click', function() {
            if (confirm('æ¸…ç©ºæ‰€æœ‰å·²é€‰å°ç±»ï¼Ÿ')) {
                selectedSubclasses = {};
                refreshUI();
                renderTree(document.getElementById('searchInput').value);
            }
        });

        let searchTimer;
        document.getElementById('searchInput').addEventListener('input', function(e) {
            clearTimeout(searchTimer);
            searchTimer = setTimeout(() => {
                renderTree(e.target.value);
            }, 300);
        });

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewBox = document.getElementById('imagePreview');
        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                trademarkImageData = ev.target.result;
                previewBox.innerHTML = `<img src="${ev.target.result}" alt="å•†æ ‡å›¾æ ·é¢„è§ˆ">`;
            };
            reader.readAsDataURL(file);
        });

        document.querySelectorAll('input[name="scheme"]').forEach(r => {
            r.addEventListener('change', () => {
                updateSchemeSelection();
                refreshUI();
            });
        });
        document.getElementById('invoiceCheckbox').addEventListener('change', function() {
            document.getElementById('invoiceLabel').style.color = this.checked ? '#c00000' : 'inherit';
            refreshUI();
        });

        document.getElementById('previewOrderBtn').addEventListener('click', function() {
            alert('å½“å‰è´¹ç”¨æ˜ç»†ï¼š\n\n' + computeFeeText());
        });

        async function exportWord() {
            const applicant = cleanInput(document.getElementById('applicantName').value) || 'æœªå¡«å†™';
            const tmName = cleanInput(document.getElementById('trademarkName').value) || 'æœªå¡«å†™';
            const phone = cleanInput(document.getElementById('contactPhone').value) || '';
            const contact = cleanInput(document.getElementById('contactPerson').value) || '';

            if (!applicant || !tmName) {
                alert('è¯·å¡«å†™ç”³è¯·äººå…¨ç§°å’Œå•†æ ‡åç§°');
                return;
            }
            if (Object.keys(selectedSubclasses).length === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå°ç±»');
                return;
            }

            const style = `
                body {
                    font-family: 'å¾®è½¯é›…é»‘', 'Segoe UI', sans-serif;
                    margin: 1.5cm 1.5cm;
                    font-size: 12pt;
                    line-height: 1.4;
                }
                h2 {
                    color: #003d7c;
                    margin: 0.5em 0 0.3em;
                    font-weight: 600;
                }
                h3 {
                    margin: 0.8em 0 0.3em;
                    color: #1f3a5f;
                }
                p {
                    margin: 0.2em 0;
                }
                ul, ol {
                    margin: 0.2em 0 0.2em 1.8em;
                    padding: 0;
                }
                li {
                    margin: 0;
                    line-height: 1.4;
                }
                pre {
                    background: #f4f8ff;
                    padding: 10px;
                    margin: 0.5em 0;
                    line-height: 1.4;
                    font-family: inherit;
                    white-space: pre-wrap;
                    border-radius: 8px;
                    border: 1px solid #c9d8ec;
                }
                img {
                    max-width: 200px;
                    border: 1px solid #ddd;
                    border-radius: 6px;
                    margin: 0.5em 0;
                }
                .bold { font-weight: 600; }
                .red { color: #c00000; }
            `;

            let htmlContent = `
            <html>
            <head><meta charset="UTF-8"><title>å•†æ ‡ç”³è¯·è®¢å•</title>
            <style>${style}</style>
            </head>
            <body>
            <h2 style="text-align:center;">ğŸ“„ å•†æ ‡ç”³è¯·è®¢å•</h2>
            <p><strong>ç”³è¯·äººå…¨ç§°ï¼š</strong>${escapeHtml(applicant)}</p>
            <p><strong>å•†æ ‡åç§°ï¼š</strong>${escapeHtml(tmName)}</p>
            <p><strong>è”ç³»ç”µè¯ï¼š</strong>${escapeHtml(phone)}</p>
            <p><strong>è”ç³»äººï¼š</strong>${escapeHtml(contact)}</p>
            <p><strong>æ—¥æœŸï¼š</strong>${new Date().toLocaleDateString('zh-CN')}</p>
            <h3>ä¸€ã€å·²é€‰ç±»åˆ«æ˜ç»†</h3>
            <ul>`;
            for (let major in selectedSubclasses) {
                htmlContent += `<li><strong>ã€${escapeHtml(major)}ã€‘</strong><ul>`;
                selectedSubclasses[major].forEach(s => htmlContent += `<li>${escapeHtml(s)}</li>`);
                htmlContent += `</ul></li>`;
            }
            htmlContent += `</ul>`;
            if (trademarkImageData) {
                htmlContent += `<h3>äºŒã€å•†æ ‡å›¾æ ·</h3><img src="${trademarkImageData}" alt="å•†æ ‡å›¾æ ·" />`;
            }
            htmlContent += `<h3>ä¸‰ã€æœåŠ¡æ–¹æ¡ˆåŠè´¹ç”¨</h3><pre>${computeFeeText()}</pre>`;
            htmlContent += `<p style="margin-top:1em;">â€”â€” æœ¬è®¢å•ç”±ä¼ä¼˜å’¨ç³»ç»Ÿç”Ÿæˆ â€”â€”</p></body></html>`;

            const blob = new Blob([htmlContent], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `å•†æ ‡è®¢å•_${applicant}_${tmName}.doc`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        document.getElementById('exportWordBtn').addEventListener('click', exportWord);

        function generateContract() {
            const applicant = cleanInput(document.getElementById('applicantName').value);
            const tmName = cleanInput(document.getElementById('trademarkName').value);
            const phone = cleanInput(document.getElementById('contactPhone').value);
            const contact = cleanInput(document.getElementById('contactPerson').value);

            if (!applicant || !tmName) {
                alert('è¯·å¡«å†™ç”³è¯·äººå…¨ç§°å’Œå•†æ ‡åç§°');
                return;
            }
            if (Object.keys(selectedSubclasses).length === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå°ç±»');
                return;
            }

            const d = computeFeeDetails();
            const stats = getSelectedStats();
            const today = new Date().toLocaleDateString('zh-CN');
            const contractNo = `QYZ-TM-${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,'0')}${String(new Date().getDate()).padStart(2,'0')}${String(Math.floor(Math.random()*1000)).padStart(3,'0')}`;

            let feeRows = '';
            let idx = 1;
            for (let major in d.majorDetails) {
                let cost = d.majorDetails[major].cost;
                feeRows += `<tr><td>${idx}</td><td>${escapeHtml(major)}</td><td>${d.majorDetails[major].count}</td><td>${cost.toFixed(2)}</td></tr>`;
                idx++;
            }

            let discountRow = '';
            if (d.scheme === 'B' && d.majorCount > 6) {
                discountRow = `<tr><td></td><td colspan="2" style="text-align:right; font-weight:bold;">Bæ–¹æ¡ˆå¤§å®¢æˆ·ä¼˜æƒ ï¼ˆç«‹å‡15%ï¼‰</td><td style="color:red;">-${(d.totalOriginal - d.finalTotal).toFixed(2)}</td></tr>`;
            }
            let invoiceRow = '';
            if (d.withInvoice) {
                invoiceRow = `<tr><td></td><td colspan="2" style="text-align:right; font-weight:bold;">ä¸“ç¥¨è´¹ç”¨ï¼ˆåŠ æ”¶5%ï¼‰</td><td>${d.invoiceAmount.toFixed(2)}</td></tr>`;
            }

            let paymentPlan = '';
            if (d.scheme === 'A' || d.scheme === 'B') {
                let totalPay = d.withInvoice ? d.totalWithInvoice : d.finalTotal;
                paymentPlan = `<p><strong>ä»˜æ¬¾è®¡åˆ’ï¼š</strong>æœ¬åˆåŒç­¾è®¢å3ä¸ªå·¥ä½œæ—¥å†…ï¼Œç”²æ–¹ä¸€æ¬¡æ€§æ”¯ä»˜åˆåŒæ€»é‡‘é¢ ${totalPay.toFixed(2)} å…ƒè‡³ä¹™æ–¹æŒ‡å®šè´¦æˆ·ã€‚</p>`;
            } else {
                let baseFirst = d.withInvoice ? d.totalWithInvoice : d.finalTotal;
                let firstPay = baseFirst * (300/1100);
                paymentPlan = `<p><strong>ä»˜æ¬¾è®¡åˆ’ï¼ˆåç½®ä»˜è´¹ï¼‰ï¼š</strong></p>
                <p>â‘  é¦–ä»˜æ¬¾ï¼šåˆåŒç­¾è®¢å3ä¸ªå·¥ä½œæ—¥å†…æ”¯ä»˜ ${firstPay.toFixed(2)} å…ƒï¼ˆåˆåŒæ€»é‡‘é¢çš„27.27%ï¼‰ã€‚</p>
                <p>â‘¡ å°¾æ¬¾ï¼šæ¯æœ‰ä¸€ä¸ªå¤§ç±»ä¸‹å‘å•†æ ‡æ³¨å†Œè¯åï¼Œç”²æ–¹åº”åœ¨æ”¶åˆ°ä¹™æ–¹é€šçŸ¥ä¹‹æ—¥èµ·3ä¸ªå·¥ä½œæ—¥å†…æ”¯ä»˜è¯¥å¤§ç±»çš„å°¾æ¬¾ã€‚å°¾æ¬¾æ˜ç»†å¦‚ä¸‹ï¼š</p>
                <ul>`;
                for (let major in d.majorDetails) {
                    let cost = d.majorDetails[major].cost;
                    let withInvoiceCost = d.withInvoice ? cost * 1.05 : cost;
                    let tail = withInvoiceCost * d.tailPercent;
                    paymentPlan += `<li>ã€${escapeHtml(major)}ã€‘å¤§ç±»å°¾æ¬¾ï¼š${withInvoiceCost.toFixed(2)} Ã— ${(d.tailPercent*100).toFixed(2)}% = ${tail.toFixed(2)}å…ƒ</li>`;
                }
                paymentPlan += `</ul>`;
                if (d.majorCount > 6) {
                    paymentPlan += `<p style="color:red;"><strong>ğŸ Cæ–¹æ¡ˆå¤§å®¢æˆ·ä¼˜æƒ ï¼šå°¾æ¬¾å·²å‡å…15%</strong></p>`;
                }
            }

            const contractHtml = `<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>å•†æ ‡ç”³è¯·ä»£ç†æœåŠ¡åˆåŒ</title>
<style>
    body { font-family: 'å¾®è½¯é›…é»‘', 'å®‹ä½“', sans-serif; margin: 2cm 2cm; font-size: 12pt; line-height: 1.5; }
    h2 { text-align: center; color: #003d7c; margin-bottom: 0.5cm; }
    h3 { color: #1f3a5f; margin: 0.8cm 0 0.3cm; border-left: 5px solid #0078D7; padding-left: 8px; }
    p { margin: 0.3cm 0; }
    table { border-collapse: collapse; width: 100%; margin: 0.5cm 0; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: left; }
    th { background: #f0f4fa; font-weight: bold; }
    .signature { margin-top: 1cm; display: flex; justify-content: space-between; }
    .signature div { width: 45%; }
    .underline { text-decoration: underline; color: #c00000; }
    .legal { background: #f9f2e0; padding: 8px; border-left: 4px solid #f0b342; margin: 0.5cm 0; }
</style>
</head>
<body>
<h2>ğŸ“ å•†æ ‡ç”³è¯·ä»£ç†æœåŠ¡åˆåŒ</h2>
<p><strong>åˆåŒç¼–å·ï¼š</strong>${contractNo}</p>
<p><strong>ç­¾è®¢æ—¥æœŸï¼š</strong>${today}</p>

<h3>ä¸€ã€ç”²æ–¹ï¼ˆå§”æ‰˜äººï¼‰ä¿¡æ¯</h3>
<p><strong>å…¬å¸åç§°/ä¸ªäººå§“åï¼š</strong>${escapeHtml(applicant)}</p>
<p><strong>ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç /èº«ä»½è¯å·ç ï¼š</strong><span class="underline">ï¼ˆå¡«å†™è¯¦ç»†ï¼‰</span></p>
<p><strong>å·¥å•†æ³¨å†Œåœ°å€/èº«ä»½è¯åœ°å€ï¼š</strong><span class="underline">ï¼ˆå¡«å†™è¯¦ç»†ï¼‰</span></p>
<p><strong>è”ç³»äººï¼š</strong>${escapeHtml(contact || 'ï¼ˆè¯·å¡«å†™ï¼‰')}</p>
<p><strong>è”ç³»ç”µè¯ï¼š</strong>${escapeHtml(phone || 'ï¼ˆè¯·å¡«å†™ï¼‰')}</p>

<h3>äºŒã€ä¹™æ–¹ï¼ˆå—æ‰˜äººï¼‰ä¿¡æ¯</h3>
<p><strong>å…¬å¸åç§°ï¼š</strong>ä¼ä¼˜å’¨ï¼ˆå¹¿å·ï¼‰å’¨è¯¢æœ‰é™å…¬å¸</p>
<p><strong>ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼š</strong>91440111MADMM9PF77</p>
<p><strong>æ³¨å†Œåœ°å€ï¼š</strong>å¹¿å·å¸‚å¤©æ²³åŒºä½“è‚²ä¸œè·¯140-148å·2204æˆ¿B51å®¤</p>
<p><strong>è”ç³»äººï¼š</strong>é™ˆç„•æ³½</p>
<p><strong>ç”µè¯ï¼š</strong>13128311370</p>

<h3>ä¸‰ã€å§”æ‰˜äº‹é¡¹</h3>
<p>ç”²æ–¹å§”æ‰˜ä¹™æ–¹ä»£ç†ä»¥ä¸‹å•†æ ‡çš„æ³¨å†Œç”³è¯·äº‹å®œï¼š</p>
<p><strong>å•†æ ‡åç§°ï¼š</strong>${escapeHtml(tmName)}</p>
<p><strong>å•†æ ‡å›¾æ ·ï¼š</strong>${trademarkImageData ? 'ï¼ˆå·²ä¸Šä¼ ï¼Œè§é™„ä»¶ï¼‰' : 'ï¼ˆæœªä¸Šä¼ ï¼Œè¯·è¡¥å……ï¼‰'}</p>
<p><strong>ç”³è¯·ç±»åˆ«åŠå°ç±»æ˜ç»†ï¼š</strong></p>
<ul>
${Object.entries(selectedSubclasses).map(([major, subs]) => 
    `<li><strong>ã€${escapeHtml(major)}ã€‘</strong>ï¼š${subs.map(s => escapeHtml(s)).join('ï¼›')}</li>`
).join('')}
</ul>
<p><strong>å…±è®¡ï¼š</strong>${stats.majorCount}ä¸ªå¤§ç±»ï¼Œ${stats.totalSubCount}ä¸ªå°ç±»ã€‚</p>

<h3>å››ã€æœåŠ¡æ–¹æ¡ˆåŠè´¹ç”¨</h3>
<p><strong>æœåŠ¡æ–¹æ¡ˆï¼š</strong>${d.scheme}æ–¹æ¡ˆ Â· ${d.params.name}</p>
<div class="legal">ğŸ“¢ ç‰¹åˆ«å£°æ˜ï¼šå•†æ ‡å®¡æŸ¥æƒå½’å±å›½å®¶çŸ¥è¯†äº§æƒå±€ï¼Œå®¡æŸ¥ç»“æœå­˜åœ¨ä¸»è§‚å› ç´ ï¼Œä»»ä½•ä»£ç†æœºæ„å‡ä¸å¾—æ‰¿è¯ºâ€œåŒ…è¿‡â€ï¼è‹¥è¢«é©³å›ã€è¢«å¼‚è®®ï¼Œå·²æ”¶å–è´¹ç”¨ä¸å¯é€€ï¼å¦‚æ‚¨æ‹…å¿ƒæ³¨å†Œè¯ä¸‹ä¸æ¥ï¼Œå¯é€‰Cæ–¹æ¡ˆï¼šä¸‹è¯åå†ä»˜æœåŠ¡è´¹ã€‚</div>

<table>
    <tr><th>åºå·</th><th>å¤§ç±»</th><th>å°ç±»æ•°é‡</th><th>è´¹ç”¨(å…ƒ)</th></tr>
    ${feeRows}
    <tr><td></td><td colspan="2" style="text-align:right;"><strong>å°è®¡ï¼ˆåŸä»·ï¼‰</strong></td><td>${d.totalOriginal.toFixed(2)}</td></tr>
    ${discountRow}
    ${invoiceRow}
    <tr><td></td><td colspan="2" style="text-align:right;"><strong>åˆåŒæ€»é‡‘é¢</strong></td><td><strong style="color:#c00000;">${(d.withInvoice ? d.totalWithInvoice : d.finalTotal).toFixed(2)}</strong></td></tr>
</table>

<h3>äº”ã€ä»˜æ¬¾æ–¹å¼</h3>
${paymentPlan}
<p><strong>ä¹™æ–¹æ”¶æ¬¾è´¦æˆ·ï¼š</strong></p>
<p>è´¦æˆ·åç§°ï¼šä¼ä¼˜å’¨ï¼ˆå¹¿å·ï¼‰å’¨è¯¢æœ‰é™å…¬å¸<br>
è´¦æˆ·å·ç ï¼š4405 0158 0107 0000 4275<br>
å¼€æˆ·é“¶è¡Œï¼šä¸­å›½å»ºè®¾é“¶è¡Œè‚¡ä»½æœ‰é™å…¬å¸å¹¿å·èŠ±åŸæ”¯è¡Œ</p>

<h3>å…­ã€åŒæ–¹æƒåˆ©ä¹‰åŠ¡</h3>
<p>ï¼ˆ1ï¼‰ç”²æ–¹åº”ä¿è¯æä¾›çš„èµ„æ–™çœŸå®ã€åˆæ³•ï¼Œå¹¶é…åˆä¹™æ–¹å®Œæˆç”³è¯·ï¼›</p>
<p>ï¼ˆ2ï¼‰ç”²æ–¹åº”æŒ‰çº¦å®šæ”¯ä»˜è´¹ç”¨ï¼Œè‡ªæœåŠ¡å¯åŠ¨åä¸å¾—ä»¥ä»»ä½•ç†ç”±è¦æ±‚é€€æ¬¾ï¼›</p>
<p>ï¼ˆ3ï¼‰ä¹™æ–¹åº”æŒ‰ç…§ä¸“ä¸šæ ‡å‡†æä¾›æœåŠ¡ï¼Œå¹¶åŠæ—¶æŠ¥å‘Šè¿›å±•ï¼›</p>
<p>ï¼ˆ4ï¼‰ä¹™æ–¹å¯¹ç”²æ–¹ä¿¡æ¯ä¿å¯†ï¼Œä¸æ‰¿è¯ºç”³è¯·ç»“æœã€‚</p>

<h3>ä¸ƒã€è¿çº¦è´£ä»»</h3>
<p>ç”²æ–¹é€¾æœŸä»˜æ¬¾çš„ï¼Œæ¯é€¾æœŸä¸€æ—¥æŒ‰åº”ä»˜é‡‘é¢çš„åƒåˆ†ä¹‹äº”æ”¯ä»˜è¿çº¦é‡‘ã€‚å› ç”²æ–¹èµ„æ–™é—®é¢˜å¯¼è‡´é©³å›çš„ï¼Œç”±ç”²æ–¹æ‰¿æ‹…è´£ä»»ã€‚</p>

<h3>å…«ã€å…¶ä»–</h3>
<p>æœ¬åˆåŒä¸€å¼ä¸¤ä»½ï¼Œç”²ä¹™åŒæ–¹å„æ‰§ä¸€ä»½ï¼Œå…·æœ‰åŒç­‰æ³•å¾‹æ•ˆåŠ›ã€‚æœªå°½äº‹å®œå¯ç­¾è®¢è¡¥å……åè®®ã€‚</p>

<div class="signature">
    <div><strong>ç”²æ–¹ï¼ˆç›–ç« ï¼‰ï¼š</strong><br><br>æˆæƒä»£è¡¨ï¼š${escapeHtml(contact || '__________')}<br>æ—¥æœŸï¼š${today}</div>
    <div><strong>ä¹™æ–¹ï¼ˆç›–ç« ï¼‰ï¼š</strong>ä¼ä¼˜å’¨ï¼ˆå¹¿å·ï¼‰å’¨è¯¢æœ‰é™å…¬å¸<br><br>æˆæƒä»£è¡¨ï¼šé™ˆç„•æ³½<br>æ—¥æœŸï¼š${today}</div>
</div>

<p style="text-align:right;">â€”â€” æœ¬åˆåŒç”±ä¼ä¼˜å’¨ç³»ç»Ÿç”Ÿæˆï¼Œè¯·ä»”ç»†æ ¸å¯¹ â€”â€”</p>
</body>
</html>`;

            const blob = new Blob([contractHtml], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `å•†æ ‡åˆåŒ_${applicant}_${tmName}.doc`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        document.getElementById('generateContractBtn').addEventListener('click', generateContract);

        // ---------- æ–°å¢é€‰é¡¹å¡åˆ‡æ¢é€»è¾‘ ----------
        const tabOrder = document.getElementById('tabOrder');
        const tabFlow = document.getElementById('tabFlow');
        const orderPanel = document.getElementById('orderPanel');
        const flowPanel = document.getElementById('flowPanel');

        tabOrder.addEventListener('click', function() {
            tabOrder.classList.add('active');
            tabFlow.classList.remove('active');
            orderPanel.style.display = 'grid';
            flowPanel.style.display = 'none';
        });

        tabFlow.addEventListener('click', function() {
            tabFlow.classList.add('active');
            tabOrder.classList.remove('active');
            orderPanel.style.display = 'none';
            flowPanel.style.display = 'block';
        });

        // å¯åŠ¨
        loadJSON();

        document.querySelectorAll('.scheme-option').forEach(opt => {
            opt.addEventListener('click', function(e) {
                if (e.target.tagName === 'INPUT') return;
                const radio = this.querySelector('input[type="radio"]');
                if (radio) radio.checked = true;
                radio.dispatchEvent(new Event('change'));
            });
        });

        updateSchemeSelection();
    })();
</script>
</body>
</html>
